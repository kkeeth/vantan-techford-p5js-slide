---
theme: seriph
background: https://source.unsplash.com/collection/94734566/1920x1080
class: "text-center"
lineNumbers: false
info: |
  ## ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆp5.jsï¼‰è¬›ç¾©è³‡æ–™#17
  VANTAN Techgord Academy
  Created by [@kuwahara_jsri](https://twitter.com/kuwahara_jsri)
fonts:
  sans: "Josefin Sans"
  serif: "Noto Sans JP"
  mono: "Fira Code"
drawings:
  persist: false
highlighter: prism-xonokai
title: ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆp5.jsï¼‰è¬›ç¾©
css: unocss
---

# ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆp5.jsï¼‰è¬›ç¾©

VANTAN Techford Academy

### #17 GLSL å…¥é–€â‘¡

<div class="pt-12">
  <span @click="$slidev.nav.next" class="px-2 py-1 rounded cursor-pointer" hover="bg-white bg-opacity-10">
    Press Space for next page <carbon:arrow-right class="inline"/>
  </span>
</div>

<div class="abs-br m-6 flex gap-2">
  <button @click="$slidev.nav.openInEditor()" title="Open in Editor" class="text-xl icon-btn opacity-50 !border-none !hover:text-white">
    <carbon:edit />
  </button>
  <a href="https://github.com/kkeeth/vantan-techford-p5js-slide" target="_blank" alt="GitHub"
    class="text-xl icon-btn opacity-50 !border-none !hover:text-white">
    <carbon-logo-github />
  </a>
</div>

---
layout: center
class: text-center
---

# å‡ºå¸­ ğŸ™‹

---
layout: center
---

# ä»Šæ—¥è©±ã™ã“ã¨ğŸ“‹

---

# â–¼ GLSL å…¥é–€â‘¡

<br />


## ğŸ‘‰ è»½ãå‰å›ã®å¾©ç¿’

<br />

## ğŸ‘‰ `GLSL` ã®æ›¸ãæ–¹ã‚’è§£èª¬

<br />

## ğŸ‘‰ è‰²ã‚“ãªä½œå“ã®ã‚³ãƒ¼ãƒ‰ã‚’è§£æã—ã¦ã¿ã‚ˆã†

<br />

## ğŸ‘‰ `twigl.app` ã¨ã„ã†ã‚µã‚¤ãƒˆã§éŠã‚“ã§ã¿ã‚ˆã†

---
layout: center
---

# æˆæ¥­è³‡æ–™ğŸ“‹
<br />

[https://vantan-techford-p5js-slide.vercel.app/](https://vantan-techford-p5js-slide.vercel.app/)

<br />

<img width="600" class="mx-auto" src="/assets/1/text.png" alt="è¬›ç¾©è³‡æ–™" />

---
layout: center
---

# è»½ãå‰å›ã®å¾©ç¿’ğŸ“

---
layout: center
---

# ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ï¼ŒGLSL ã¨ã¯

<style>
h1 {
  background-color: #2B90B6;
  background-image: linear-gradient(45deg, #4EC5D4 10%, #146b8c 20%);
  background-size: 100%;
  -webkit-background-clip: text;
  -moz-background-clip: text;
  -webkit-text-fill-color: transparent;
  -moz-text-fill-color: transparent;
}
</style>

---

# ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã¨ã¯

> 3æ¬¡å…ƒã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã«ãŠã„ã¦ã€ã‚·ã‚§ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆé™°å½±å‡¦ç†ï¼‰ã‚’è¡Œã†ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã“ã¨ã€‚ã€Œshadeã€ã¨ã¯ã€Œæ¬¡ç¬¬ã«å¤‰åŒ–ã•ã›ã‚‹ã€ã€Œé™°å½±ãƒ»ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹ã€ã¨ã„ã†æ„å‘³ã§ã€ã€Œshaderã€ã¯é ‚ç‚¹è‰²ã‚„ãƒ”ã‚¯ã‚»ãƒ«è‰²ãªã©ã‚’æ¬¡ã€…ã«å¤‰åŒ–ã•ã›ã‚‹ã‚‚ã®ï¼ˆã‚ˆã‚Šå…·ä½“çš„ã«ã€ç‹­ç¾©ã®æ„å‘³ã§è¨€ãˆã°é–¢æ•°ï¼‰ã‚’æ„å‘³ã™ã‚‹ã€‚
> [wikipedia](https://ja.wikipedia.org/wiki/%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC) ã‚ˆã‚Š

å¹³ãŸãè¨€ãˆã°æç”»ã«ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚’ä»˜ã‘ã‚‹ãŸã‚ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã“ã¨ã§ã™ã­ï¼æ–‡å­—é€šã‚Š __ã©ã®ã‚ˆã†ã«å…‰ã‚’å½“ã¦ã‚‹ã‹__ï¼Œ__ã©ã®ã‚ˆã†ã«è‰²ã‚’ä»˜ã‘ã‚‹ã‹__ ã®å‡¦ç†ãŒä¸»ã¨æ€ã£ã¦ã„ãŸã ã„ã¦è‰¯ã„ã¨æ€ã„ã¾ã™ï¼

---

# GLSL ã¨ã¯

> GLSL (OpenGL Shading Language) ã¯GLslangã¨ã—ã¦ã‚‚çŸ¥ã‚‰ã‚Œã€Cè¨€èªã®æ§‹æ–‡ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸé«˜ãƒ¬ãƒ™ãƒ«ã‚·ã‚§ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¨€èªã§ã‚ã‚‹ã€‚ã“ã‚Œã¯ã‚¢ã‚»ãƒ³ãƒ–ãƒªè¨€èªã‚„ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã«ä¾å­˜ã—ãŸè¨€èªã‚’ä½¿ã‚ãªã„ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºè€…ãŒã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ç›´æ¥åˆ¶å¾¡ã§ãã‚‹ã‚ˆã†ã«OpenGL ARB (Architecture Review Board)ã§ç­–å®šã•ã‚ŒãŸã€‚
> [wikipedia](https://ja.wikipedia.org/wiki/GLSL) ã‚ˆã‚Š

ã“ã®ã‚ã¨è§¦ã‚Œã¾ã™ãŒï¼ŒGLSL ã§ã¯ä»¥ä¸‹ï¼’ã¤ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼

* `é ‚ç‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼`
  * é ‚ç‚¹ã®ä½ç½®ã‚’è¨ˆç®—ã‚’è¡Œã†
  * ä½ç½®åº§æ¨™ã‚„æ³•ç·šãƒ™ã‚¯ãƒˆãƒ«ãªã©ã®é ‚ç‚¹ã®å±æ€§ã ã‘ã‚’å‚ç…§ãƒ»å¤‰æ›ã™ã‚‹è¨˜è¿°

* `ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼`
  * è‰²ã®æƒ…å ±ã®æç”»å‡¦ç†ã‚’è¡Œã†
  * ãƒ”ã‚¯ã‚»ãƒ«å˜ä½ã®è‰²ã®è¨ˆç®—ã‚’ã™ã‚‹è¨˜è¿°

---

# ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼å®Ÿè¡Œã®ã‚¤ãƒ¡ãƒ¼ã‚¸

<img src="/assets/17/shader_detail.png" alt="ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®ä»•çµ„ã¿" class="mx-auto" width="" />

---

# ç‰©å‡„ã„å‚è€ƒã«ãªã‚‹ã‚µã‚¤ãƒˆ

#### ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’å‹‰å¼·ã™ã‚‹ãªã‚‰ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆãŒã¨ã¦ã‚‚å‹‰å¼·ã«ãªã‚Šã¾ã™ğŸ™‹

<img src="/assets/16/p5js-shader.png" alt="p5.js shader" class="mx-auto border-1" width="640" />

ã‚µã‚¤ãƒˆURL: [https://itp-xstory.github.io/p5js-shaders/](https://itp-xstory.github.io/p5js-shaders/)

---

# ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«å…¥é–€

### ã¾ãšã¯ãƒ™ã‚¿ã«ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ©ãƒ¼ã‚’è¡¨ç¾ã—ã¾ã—ãŸğŸ™‹

<img src="/assets/17/shader_init.png" alt="" class="mt-4 mx-auto" width="700" />

---
layout: center
---

# GLSL ã®æ›¸ãæ–¹ã‚’è§£èª¬

<style>
h1 {
  background-color: #2B90B6;
  background-image: linear-gradient(45deg, #4EC5D4 10%, #146b8c 20%);
  background-size: 100%;
  -webkit-background-clip: text;
  -moz-background-clip: text;
  -webkit-text-fill-color: transparent;
  -moz-text-fill-color: transparent;
}
</style>

---

# é ‚ç‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ `shader.vert` ã®è§£èª¬

### ã¾ãšã¯ã‚³ãƒ¼ãƒ‰ã‚’å†æ²

```glsl
#ifdef GL_ES
precision highp float;
#endif

// attribute ä¿®é£¾å­ä»˜ã® vec3 å‹ã®å¤‰æ•°
// å„é ‚ç‚¹å€‹åˆ¥ã«åˆ¶å¾¡ã—ãŸã„æ™‚ã«åˆ©ç”¨
attribute vec3 aPosition;

// Cè¨€èªãªã‚‰ãŠãªã˜ã¿ã®mainé–¢æ•°
// ã‚·ã‚§ãƒ¼ãƒ€ã¯ã“ã®é–¢æ•°å†…ã«å‡¦ç†ã‚’è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
void main() {
  // vec4 å‹ã®å¤‰æ•°
  vec4 positionVec4 = vec4(aPosition, 1.0);
  // è‰²ã‚“ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã‚ã‚Šã¾ã™ãŒï¼Œä»Šå›ã¯ï¼’æ¬¡å…ƒã®çµµã‚’æãã®ã§
  positionVec4.xy = positionVec4.xy * 2.0 - 1.0;
  gl_Position = positionVec4;
}
```

---

# é ‚ç‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ `shader.vert` ã®è§£èª¬

### â–¼ `#ifdef`, `#endif`
å³å¯†ã«ã¯ c++ ã®æ›¸ãæ–¹ã§ï¼Œ`GL_ES` ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹å ´åˆã«ä¸Šè¨˜ã®ï¼’ã¤ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ï¼ˆã¨è¨€ã£ãŸã‚Šã—ã¾ã™ï¼‰ã«æŒŸã¾ã‚Œã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å‡¦ç†ã™ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ï¼

<br />

### â–¼ `precision highp float;`

å…¨ä½“ã¨ã—ã¦ç²¾åº¦ã®å®£è¨€ã¨æŒ‡å®šã‚’ã—ã¦ãŠã‚Šï¼Œãã‚Œãã‚Œã®æ„å‘³ã¯ä»¥ä¸‹ã§ã™ï¼

* `precision`: æ•°å€¤æ¼”ç®—ã®ç²¾åº¦ã‚’è¡¨ã™
* `highp`: ç²¾åº¦ä¿®é£¾å­ï¼å¤‰æ•°ã®ç²¾åº¦ã‚’æŒ‡å®šï¼ˆã“ã®å ´åˆã¯é«˜ç²¾åº¦ï¼‰
  * `highp`, `mediump`, `lowp` ã®ï¼“ç¨®é¡
* `float`: æµ®å‹•å°æ•°ç‚¹å‹ã‚’æ„å‘³ã™ã‚‹

---

# é ‚ç‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ `shader.vert` ã®è§£èª¬

### â–¼ `attribute vec3 aPosition;`

ã“ã¡ã‚‰ã‚‚å¤‰æ•°ã®å®šç¾©ã‚’ã—ã¦ãŠã‚Šï¼Œãã‚Œãã‚Œã®æ„å‘³ã¯ä»¥ä¸‹ã§ã™ï¼

* `attribute`: ä¿®é£¾å­
  * `attribute`: JavaScript ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰ãƒãƒ¼ãƒ†ãƒƒã‚¯ã‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«é€ã‚‰ã‚Œã‚‹å„é ‚ç‚¹ãŒæŒã¤å¤‰æ•°
  * `uniform`: JavaScript ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰ã„ãšã‚Œã‹ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«é€ã‚‰ã‚Œã‚‹å…¨é ‚ç‚¹ã§ä¸€å¾‹ã®å¤‰æ•°
  * `varying`: ãƒãƒ¼ãƒ†ãƒƒã‚¯ã‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‹ã‚‰ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«é€ã‚‰ã‚Œã‚‹å¤‰æ•°
* `vec3`: ãƒ‡ãƒ¼ã‚¿å‹ï¼ˆã“ã®å ´åˆã¯ï¼“æ¬¡å…ƒã®ãƒ™ã‚¯ãƒˆãƒ«å‹ï¼‰
  * è©³ç´°ã¯ã“ã®å¾Œ
* `aPosition`: å¤‰æ•°åï¼ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã®å¤‰æ•°ã¨ã‚«ã‚¹ã‚¿ãƒ å¤‰æ•°åã©ã¡ã‚‰ã‚‚æŒ‡å®šå¯
  * ã“ã‚Œä»¥å¤–ã«ï¼Œãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã®å®šæ•°ã‚‚å­˜åœ¨ã™ã‚‹

---

# å¤‰æ•°ã®å‹â‘ 

### â–¼ãƒ™ã‚¯ãƒˆãƒ«å‹

| å‹å | èª¬æ˜|
| --- | --- |
| vec2, vec3, vec4  | 2D,3D,4D ã®æµ®å‹•å°æ•°ç‚¹æ•°ï¼ˆfloatï¼‰ã®ãƒ™ã‚¯ãƒˆãƒ«|
| ivec2,ivec3,ivec4 | 2D,3D,4D ã®æ•´æ•°ï¼ˆintï¼‰ã®ãƒ™ã‚¯ãƒˆãƒ«|
| bvec2,bvec3,bvec4 | 2D,3D,4D ã®çœŸå½å€¤ï¼ˆboolï¼‰ã®ãƒ™ã‚¯ãƒˆãƒ«|

<br />
<br />

### â–¼è¡Œåˆ—å‹

| å‹å           | èª¬æ˜ |
| -------------- | ----------------------- |
| mat2,mat3,mat4 | 2x2,3x3,4x4 è¡Œåˆ—(float) |

---

# å¤‰æ•°ã®å‹â‘¡

### â–¼ãƒ†ã‚¯ã‚¹ãƒãƒ£å‹

| å‹å                                      | èª¬æ˜                                                                                   |
| ----------------------------------------- | -------------------------------------------------------------------------------------- |
| sampler1D,sampler2D,sampler3D             | 1D,2D,3Dãƒ†ã‚¯ã‚¹ãƒãƒ£(GL_TEXTURE_1D,2D,3Dã«å¯¾å¿œ)                                          |
| samplerCube                               | ã‚­ãƒ¥ãƒ¼ãƒ–ãƒãƒƒãƒ—ãƒ†ã‚¯ã‚¹ãƒãƒ£(TEXTURE_CUBE_MAPã«å¯¾å¿œ)                                       |
| sampler2DRect                             | 2ã®nä¹—ä»¥å¤–ã®å¤§ãã•ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£(GL_TEXTURE_RECTANGLEã«å¯¾å¿œï¼Œè¦GL_ARB_texture_rectangle) |
| sampler1DArray, sampler2DArray            | 1D,2Dãƒ†ã‚¯ã‚¹ãƒãƒ£é…åˆ—(TEXTURE_1D,2D_ARRAYã«å¯¾å¿œï¼Œè¦ GL_EXT_texture_array)                |

<br />

â€»ãƒ‡ãƒ—ã‚¹ãƒ†ã‚¯ãƒãƒ£ï¼ˆ`sampler2Dshadow`, `sampler2DRectShadow`, `sampler1DArrayShadow` ãªã©ï¼‰ã¨å‘¼ã°ã‚Œã‚‹å‹ã‚‚ã‚ã‚Šã¾ã™ãŒå‰²æ„›ã—ã¾ã™ğŸ™‡

---

# ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã®å¤‰æ•°åâ‘ 

### `attribute` å®šæ•°

|å¤‰æ•°å|å‹|èª¬æ˜|
|:----|:----|:----|
|gl_Vertex|vec4|é ‚ç‚¹åº§æ¨™|
|gl_Normal|vec3|é ‚ç‚¹æ³•ç·š|
|gl_Color|vec4|é ‚ç‚¹è‰²|
|gl_MultiTexCoord*|vec4|ãƒ†ã‚¯ã‚¹ãƒãƒ£*ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£åº§æ¨™|
| | | |
|gl_ModelViewMatrix|mat4|ãƒ¢ãƒ‡ãƒ«ãƒ“ãƒ¥ãƒ¼è¡Œåˆ—|
|gl_ProjectionMatrix|mat4|ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³è¡Œåˆ—|
|gl_ModelViewProjectionMatrix|mat4|ãƒ¢ãƒ‡ãƒ«ãƒ“ãƒ¥ãƒ¼ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³è¡Œåˆ—ã®ç©|
|gl_NormalMatrix|mat3|ãƒ¢ãƒ‡ãƒ«ãƒ“ãƒ¥ãƒ¼è¡Œåˆ—ã®é€†è¡Œåˆ—(æ³•ç·šå¤‰æ›ç”¨)|

---

# ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã®å¤‰æ•°åâ‘¡

### `uniform` å¤‰æ•°

|å¤‰æ•°å|å‹|èª¬æ˜|
|:----|:----|:----|
|gl_FrontColor|vec4|è¡¨é¢ã®è‰²|
|gl_BackColor|vec4|èƒŒé¢ã®è‰²|
|gl_TexCoord[]|vec4|ãƒ†ã‚¯ã‚¹ãƒãƒ£åº§æ¨™|
| | | |
|gl_Position|vec4|é ‚ç‚¹ä½ç½®(é ‚ç‚¹ã‚·ã‚§ãƒ¼ãƒ€ã®ã¿)|
|gl_FragColor|vec4|ãƒ•ãƒ¬ãƒ¼ãƒ ãƒãƒƒãƒ•ã‚¡ã«æ›¸ãè¾¼ã¾ã‚Œã‚‹è‰²(ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ã®ã¿)|
|gl_FragDepth|float|ãƒ•ãƒ¬ãƒ¼ãƒ ãƒãƒƒãƒ•ã‚¡ã«æ›¸ãè¾¼ã¾ã‚Œã‚‹ãƒ‡ãƒ—ã‚¹å€¤(ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ã®ã¿)|

---

# æ³¨æ„

### GLSL 1.3 ã‹ã‚‰ `attribute`, `varying` ãŒéæ¨å¥¨ã«

* ç’°å¢ƒã«ã‚ˆã£ã¦ã¯ä½¿ç”¨ã™ã‚‹ã¨ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«
* å¤‰æ›´ç‚¹
  * ã‚·ã‚§ãƒ¼ãƒ€ã«å…¥ã£ã¦ãã‚‹ã‚‚ã®ï¼ˆ`attribute` ã‚„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ã® `varying` å¤‰æ•°ï¼‰ã¯ `in` ã‚’ä½¿ã†
  * å‡ºã¦è¡Œãã‚‚ã®ï¼ˆé ‚ç‚¹ã‚·ã‚§ãƒ¼ãƒ€ã® `varying` å¤‰æ•°ã‚„ `gl_FragColor`ï¼‰ã¯ `out` ã‚’ä½¿ã†
* `gl_Position`ã€€ã‚„ã€€`gl_PointSize` ã¯å¤‰æ›´ãªã—
* ç¾æ™‚ç‚¹ã® `p5.js` ã® GLSL ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 1.2 ã®ãŸã‚ã“ã®ã¾ã¾åˆ©ç”¨

â€»å‚è€ƒãƒªãƒ³ã‚¯: [GLSL 1.50 è¨€èªä»•æ§˜](https://registry.khronos.org/OpenGL/specs/gl/GLSLangSpec.1.50.pdf)

---

# é ‚ç‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ `shader.vert` ã®è§£èª¬

### â–¼ `void main() {}`
ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã¯ `main()` é–¢æ•°å†…ã«å‡¦ç†ã‚’å®šç¾©ã—ã¾ã™

### â–¼ `gl_Position = positionVec4;`
é ‚ç‚¹åº§æ¨™ã‚’è¡¨ã™ `gl_Position` å¤‰æ•°ã«å®šç¾©ã—ãŸãƒ™ã‚¯ãƒˆãƒ«å¤‰æ•°ã‚’ã‚»ãƒƒãƒˆï¼`uniform` ã®å¤‰æ•°ã®ãŸã‚ï¼Œå…¨é ‚ç‚¹ä¸€å¾‹ã§åˆ¶å¾¡ã™ã‚‹ã“ã¨ã«æ³¨æ„ï¼

### â–¼ `vec*()` ãƒ¡ã‚½ãƒƒãƒ‰
*æ¬¡å…ƒã®ãƒ™ã‚¯ãƒˆãƒ«å¤‰æ•°ã‚’ç”Ÿæˆï¼Œ`*` ã¯2ã€œ4ã‚’æŒ‡å®šã—ã¾ã™ï¼

<br />

â€»ãã®ä»–ãŸãã•ã‚“ã®ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã®é–¢æ•°ã«ã¤ã„ã¦ã¯ [ã“ã¡ã‚‰ã®è¨˜äº‹](https://qiita.com/edo_m18/items/71f6064f3355be7e4f45) ãŒå‚è€ƒã«ãªã‚Šã¾ã™ğŸ’

---

# ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ `shader.frag` ã®è§£èª¬

### ã¾ãšã¯ã‚³ãƒ¼ãƒ‰ã‚’å†æ²

```glsl
#ifdef GL_ES
precision highp float;
#endif

// uniform ä¿®é£¾å­ä»˜ã® vec2 å‹ã®å¤‰æ•°
// å…¨é ‚ç‚¹ã«ä¸€å¾‹ã«å‡¦ç†ã—ãŸã„æ™‚ã«åˆ©ç”¨
uniform vec2 u_resolution;

void main() {
  // vec2 å‹ã®å¤‰æ•°
  vec2 uv = gl_FragCoord.xy / u_resolution.xy;
  vec3 color = vec3(uv, 1.0);

  gl_FragColor = vec4(color, 1.0);
}
```

---

# ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ `shader.frag` ã®è§£èª¬

### â–¼ `uniform vec2 u_resolution;`
è§£åƒåº¦ã‚’è¡¨ã™ã‚«ã‚¹ã‚¿ãƒ ã®ï¼’æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«å¤‰æ•° `u_resolution` ã‚’å®šç¾©ï¼æ…£ç¿’ã¨ã—ã¦é ­ã« `u` ã‚’ä»˜ã‘ã¦ã„ã¾ã™ãŒãªãã¦ã‚‚å•é¡Œãªã„ã§ã™ã—ï¼Œã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã§ã‚‚è‰¯ã„ã§ã™ï¼

<br />

### â–¼ `vec2 uv = gl_FragCoord.xy / u_resolution.xy;`
ä½•ç•ªç›®ã®ãƒ”ã‚¯ã‚»ãƒ«ã«ã„ã‚‹ã‹ã‚’è¡¨ã™ `gl_FragCoord.xy` ã‚’è§£åƒåº¦ã§å‰²ã‚‹ã“ã¨ã§ï¼Œ`vec2(0.0, 0.0)ã€œvec2(1.0, 1.0)` ã¾ã§ãƒ™ã‚¯ãƒˆãƒ«ã®æ­£è¦åŒ–ã‚’è¡Œã£ã¦ã„ã¾ã™ï¼ã“ã®å¾Œï¼Œã“ã®å€¤ã‚’ç”¨ã„ã¦ãƒ”ã‚¯ã‚»ãƒ«ã”ã¨ã®è‰²ã‚’æ±ºã‚ã¦ã„ã¾ã™ï¼

<br />

### â–¼ `gl_FragColor = vec4(color, 1.0);`
ãã‚Œãã‚Œã®ãƒ”ã‚¯ã‚»ãƒ«ã®ã‚«ãƒ©ãƒ¼ã‚’æŒ‡å®šã—ï¼Œ`gl_FragColor` å¤‰æ•°ã«ã‚»ãƒƒãƒˆã—ã¾ã™ï¼

---
layout: center
---

# è»½ãå‰å›ã®ã‚³ãƒ¼ãƒ‰ã‚’æ”¹é€ ã—ã¦éŠã‚“ã§ã¿ã¾ã—ã‚‡ã†ğŸ™‹

---

# ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´â‘ 

__sketch.js__

```diff
  let myShader;
+ let x = 0, y = 0;
+ let vx = 3, vy = 3;

  function setup() {
    createCanvas(windowWidth, windowHeight, WEBGL);
    noStroke();
    pixelDensity(1);
+ }
+
+ function draw() {
    shader(myShader);
-   myShader.setUniform('u_resolution', [width, height]);
+   myShader.setUniform('u_resolution', [x, y]);
    rect(0, 0, width, height)
+   x += vx;
+   if (x > width || x <= 0) vx *= -1;
+   y += vy;
+   if (y > height || y <= 0) vy *= -1;
    resetShader();
  }
```

---

# ã“ã‚“ãªæ„Ÿã˜ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

<img src="/assets/17/shader_practice1.png" alt="ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã®ã‚­ãƒ£ãƒ—ãƒãƒ£" class="mx-auto border-1" width="800" />

---

# ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´â‘¡

__shader.vert__

```diff
  precision highp float;

  attribute vec3 aPosition;

+ uniform mat4 uModelViewMatrix;
+ uniform mat4 uProjectionMatrix;

  void main() {
    vec4 positionVec4 = vec4(aPosition, 1.0);
-   positionVec4.xy = positionVec4.xy * 2.0 - 1.0;
-   gl_Position = positionVec4;
+   gl_Position = uProjectionMatrix * uModelViewMatrix *  positionVec4;
  }
```

<br />

â€» `uProjectionMatrix` ã¨ `uModelViewMatrix` ã¯ãã‚Œãã‚Œè¡Œåˆ—ã«ãªã‚Šã¾ã™ã®ã§ï¼Œè¨ˆç®—ã®é †ç•ªãŒé€†è»¢ã™ã‚‹ã¨æç”»ã•ã‚Œãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ğŸ’

---

# ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´â‘¡

__sketch.js__

```diff
- let x = 0, y = 0;
+ let x = 100, y = 100;
+ let vx = 3, vy = 3;

  function draw() {
+   background(255);
    shader(myShader);
-   myShader.setUniform("resolution", [x, y]);
+   myShader.setUniform("resolution", [width, height]);

+   translate(-width / 2, -height / 2);
-   rect(0, 0, width, height);
+   circle(x, y, 200);
    x += vx;
-   if (x > width || x <= 0) vx *= -1;
+   if (x + 100 > width || x - 100 <= 0) vx *= -1;
    y += vy;
-   if (y > height || y <= 0) vy *= -1;
+   if (y + 100 > height || y - 100 <= 0) vy *= -1;
    resetShader();
  }
```

---

# ã“ã‚“ãªæ„Ÿã˜ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

<img src="/assets/17/shader_practice2.png" alt="ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ï¼’æšç›®" class="mx-auto" width="800" />


---
layout: center
---

# è‰²ã‚“ãªä½œå“ã®ã‚³ãƒ¼ãƒ‰ã‚’è§£æã—ã¦ã¿ã‚ˆã†ğŸ™‹

<style>
h1 {
  background-color: #2B90B6;
  background-image: linear-gradient(45deg, #4EC5D4 10%, #146b8c 20%);
  background-size: 100%;
  -webkit-background-clip: text;
  -moz-background-clip: text;
  -webkit-text-fill-color: transparent;
  -moz-text-fill-color: transparent;
}
</style>

---
layout: center
---

# ï¼‘ä½œå“ç›®ğŸ¨
---

# ä½œå“ã‚­ãƒ£ãƒ—ãƒãƒ£

<img src="/assets/17/twigl_app.png" alt="twigl.app ã‚µã‚¤ãƒˆã®ã‚­ãƒ£ãƒ—ãƒãƒ£" class="mx-auto" width="700" />

<p class="text-right">
ç”»åƒå¼•ç”¨: <a href="https://twigl.app" target="_blank" noreferrer>twigl.app</a>
</p>

---

# ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

__sketch.js__

```js
let myShader;

function preload() {
  myShader = loadShader("shader.vert", "shader.frag");
}

function setup() {
  createCanvas(windowWidth, windowHeight, WEBGL);
  noStroke();
  pixelDensity(1);
}

function draw() {
  shader(myShader);
  myShader.setUniform("resolution", [width, height]);
  // å¾Œè¿°ã—ã¾ã™ãŒï¼Œã“ã“ã§å€¤ã‚’ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«æ¸¡ã—ã¦ã„ã¾ã™
  myShader.setUniform("time", frameCount / 50);

  rect(0, 0, width, height);
}
```

---

# ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

__shader.vert__

```glsl
precision highp float;

attribute vec3 aPosition;

void main() {
  vec4 positionVec4 = vec4(aPosition, 1.0);
  positionVec4.xy = positionVec4.xy * 2.0 - 1.0;
  gl_Position = positionVec4;
}
```

---

# ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

__shader.frag__

```glsl
precision highp float;

uniform vec2 resolution;
uniform float time;

void main() {
  // vec2(-1.0, -1.0)ã€œvec2(1.0, 1.0) ã«æ­£è¦åŒ–ã—ãŸå¾Œï¼Œè§£åƒåº¦ã§å‰²ã‚‹ã“ã¨ã§ç”»é¢ã®ç¸¦æ¨ªæ¯”ã‚’1:1ã«å¤‰æ›
  vec2 p = (gl_FragCoord.xy * 2.0 - resolution) / min(resolution.x, resolution.y);
  for (int i = 0; i < 6; ++i) {
    p.xy = abs(p) / abs(dot(p, p)) - vec2(0.9 + cos(time * 0.2) * 0.4);
  }
  gl_FragColor = vec4(p.xxy, 1.0);

  // ä»¥ä¸‹ã®ã‚ˆã†ã«ï¼Œä¸€åº¦ vec3 ã‚’ç”¨ã„ã¦ï¼“æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«ã«ã—ã¦ã‹ã‚‰ã‚»ãƒƒãƒˆã—ã¦ã‚‚è‰¯ã„
  gl_FragColor = vec4(vec3(p, 1.0), 1.0);

  // ä»¥ä¸‹ã®ã‚ˆã†ã«è‰²ã€…ã‚«ãƒ©ãƒ¼ã‚’å¤‰ãˆã¦ã‚‚ç¶ºéº—
  gl_FragColor = vec4(p.xxy, 1.0);
  gl_FragColor = vec4(p.xyx, 1.0);
}
```

---
layout: center
---

# ï¼’ä½œå“ç›®ğŸ¨

---

# ä½œå“ã‚­ãƒ£ãƒ—ãƒãƒ£

<img src="/assets/17/shader_practice3.png" alt="twigl.app ã‚µã‚¤ãƒˆã®ã‚­ãƒ£ãƒ—ãƒãƒ£" class="mx-auto" width="560" />

<p class="text-right">
ç”»åƒå¼•ç”¨: <a href="https://p5js.org/examples/3d-shader-as-a-texture.html" target="_blank" noreferrer>p5.js å…¬å¼ã‚µãƒ³ãƒ—ãƒ«</a>
</p>

---

# ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

__sketch.js__

```js
 let theShader;
 let shaderTexture;

 let theta = 0;

 let x;
 let y;
 let outsideRadius = 200;
 let insideRadius = 100;

 function preload(){
   theShader = loadShader('shader.vert','shader.frag');
 }
 ï¼ˆç¶šãï¼‰
```

---

# ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

__sketch.js__

```js
ï¼ˆç¶šãï¼‰
 function setup() {
   createCanvas(710, 400, WEBGL);
   noStroke();

   shaderTexture = createGraphics(710, 400, WEBGL);

   shaderTexture.noStroke();

    x = -50;
    y = 0;
 }

 function draw() {
   shaderTexture.shader(theShader);

   theShader.setUniform("resolution", [width, height]);
   theShader.setUniform("time", millis() / 1000.0);
   theShader.setUniform("mouse", [mouseX, map(mouseY, 0, height, height, 0)]);

   shaderTexture.rect(0, 0, width, height);

   background(255);
   ï¼ˆç¶šãï¼‰
```

---

# ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

__sketch.js__

```js
ï¼ˆç¶šãï¼‰
   texture(shaderTexture);

   translate(-150, 0, 0);
   push();
   rotateZ(theta * mouseX * 0.0001);
   rotateX(theta * mouseX * 0.0001);
   rotateY(theta * mouseX * 0.0001);
   theta += 0.05;
   sphere(125);
   pop();

   ellipse(260, 0, 200, 200, 100);
 }

```

---

# ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

__shader.vert__

```glsl
attribute vec3 aPosition;

void main() {

  vec4 positionVec4 = vec4(aPosition, 1.0);
  positionVec4.xy = positionVec4.xy * 2.0 - 1.0;

  gl_Position = positionVec4;
}
```

---

# ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

__shader.frag__

```glsl
precision mediump float;
#endif

#define PI 3.14159265358979323846

uniform vec2 resolution;
uniform float time;
uniform vec2 mouse;

vec2 rotate2D (vec2 _st, float _angle) {
    _st -= 0.5;
    _st =  mat2(cos(_angle),-sin(_angle),
                sin(_angle),cos(_angle)) * _st;
    _st += 0.5;
    return _st;
}

vec2 tile (vec2 _st, float _zoom) {
    _st *= _zoom;
    return fract(_st);
}
```

---

# ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

```glsl
vec2 rotateTilePattern(vec2 _st){
    _st *= 2.0;

    float index = 0.0;
    index += step(1., mod(_st.x,2.0));
    index += step(1., mod(_st.y,2.0))*2.0;

    // Make each cell between 0.0 - 1.0
    _st = fract(_st);

    // Rotate each cell according to the index
    if(index == 1.0){
        //  Rotate cell 1 by 90 degrees
        _st = rotate2D(_st,PI*0.5);
    } else if(index == 2.0){
        //  Rotate cell 2 by -90 degrees
        _st = rotate2D(_st,PI*-0.5);
    } else if(index == 3.0){
        //  Rotate cell 3 by 180 degrees
        _st = rotate2D(_st,PI);
    }

    return _st;
}
```

---

# ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

__shader.frag__

```glsl
float concentricCircles(in vec2 st, in vec2 radius, in float res, in float scale) {
    float dist = distance(st,radius);
    float pct = floor(dist*res)/scale;
    return pct;
}

void main (void) {
    vec2 st = gl_FragCoord.xy/resolution.xy;
    vec2 mst = gl_FragCoord.xy/mouse.xy;
    float mdist= distance(vec2(1.0,1.0), mst);

    float dist = distance(st,vec2(sin(time/10.0),cos(time/10.0)));
    st = tile(st,10.0);

    st = rotate2D(st,dist/(mdist/5.0)*PI*2.0);

    gl_FragColor = vec4(
      vec3(concentricCircles(st, vec2(0.0,0.0), 5.0, 5.0),
      concentricCircles(st, vec2(0.0,0.0), 10.0, 10.0),
      concentricCircles(st, vec2(0.0,0.0), 20.0, 10.0)),
      1.0
    );
}
```

---
layout: center
---

# twigl.app ã¨ã„ã†ã‚µã‚¤ãƒˆã§éŠã‚“ã§ã¿ã‚ˆã†

<style>
h1 {
  background-color: #2B90B6;
  background-image: linear-gradient(45deg, #4EC5D4 10%, #146b8c 20%);
  background-size: 100%;
  -webkit-background-clip: text;
  -moz-background-clip: text;
  -webkit-text-fill-color: transparent;
  -moz-text-fill-color: transparent;
}
</style>

---

# ã‚¢ã‚¯ã‚»ã‚¹

<img src="/assets/17/twigl_app2.png" alt="twigl.app ã‚µã‚¤ãƒˆã®ã‚­ãƒ£ãƒ—ãƒãƒ£" class="mx-auto" width="700" />

<p class="text-right">
ç”»åƒå¼•ç”¨: <a href="https://twigl.app" target="_blank" noreferrer>twigl.app</a>
</p>

---

# å‚è€ƒè¨˜äº‹

<img src="/assets/17/glsl_challenge.png" alt="" class="mx-auto" width="720" />

ç”»åƒå¼•ç”¨: [GLSLæœ€çŸ­ãƒãƒ£ãƒ¬ãƒ³ã‚¸ #ã¤ã¶ã‚„ãGLSL](https://zenn.dev/yuji_ap/articles/7f7f0cfd589bad)

---
layout: center
---

## æ¬¡å›ã¯ï¼Œä¹…ã—æŒ¯ã‚Šã«è‰²ã‚“ãªæ–¹ã®ä½œå“ã‚’ãƒˆãƒ¬ãƒ¼ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ğŸ™‹

<style>
h2 {
  background-color: #2B90B6;
  background-image: linear-gradient(45deg, #4EC5D4 10%, #146b8c 20%);
  background-size: 100%;
  -webkit-background-clip: text;
  -moz-background-clip: text;
  -webkit-text-fill-color: transparent;
  -moz-text-fill-color: transparent;
  text-align: center;
}
</style>
